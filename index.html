<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/20/处理邮件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/20/处理邮件/" itemprop="url">python emial 处理邮件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-20T21:03:00+08:00">
                2018-08-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>使用python来提取邮件的附件</p>
<h1 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h1><ol>
<li><a href="https://docs.python.org/3/library/email.html" target="_blank" rel="noopener">python email</a></li>
</ol>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ol>
<li><p>创建一个email对象</p>
<pre><code>import email
with open(&apos;xx.eml&apos;, &apos;rb&apos;) as fp:
   myBytes = fp.read()
 msg = email.message_from_bytes(myBytes)
</code></pre></li>
<li><p>提取email附件</p>
<pre><code>if msg:
    for part in msg.walk():
        if not part.is_multipart():
            file_name = part.get_filename()   # 提取文件名 是二进制表示
            if file_name:
              file_head = email.header.decode_header(file_name) # 获取文件头部
              file_name_byte, charset = file_head[0] # 获取附件名(二进制表示) 和 编码格式  
              if charset:
                if &apos;gb2312&apos; not in charset:
                    file_name = file_name_byte.decode(charset)  # 获取附件名(字符串格式)
                else:
                    file_name = file_name_byte.decode(&quot;gbk&quot;)
              data = part.get_payload(decode=True) # 获取文件的字节流
              with open(file, &apos;wb&apos;) as fp:         # 保存文件
                  fp.write(data)
</code></pre></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/20/处理excel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/20/处理excel/" itemprop="url">python excel 处理邮件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-20T21:03:00+08:00">
                2018-08-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>python 处理 excel 进行读和写</p>
<h1 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h1><ol>
<li><a href="https://xlrd.readthedocs.io/en/latest/api.html#xlrd.open_workbook" target="_blank" rel="noopener">xlrd</a></li>
<li><a href="https://xlwt.readthedocs.io/en/latest/" target="_blank" rel="noopener">xlwt</a></li>
<li><a href="http://www.python-excel.org/" target="_blank" rel="noopener">excle</a></li>
</ol>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ol>
<li><p>读取</p>
<pre><code>import xlrd

file = &apos;xxx.xls&apos;
workbook = xlrd.open_workbook(file)  # 支持将二进制excel表 转换成excel对象
</code></pre></li>
</ol>
<pre><code># 遍历workbook 的 sheet
# 根据下标遍历
for index in workbook.nsheets:   
  sheet = workbook.sheet_by_index(index)

# 根据名字遍历
for name in workbook.sheet_names():
  sheet = workbook.sheet_by_name(name)

# 遍历sheet中的单元格
for row in sheet.nrows:
  for col in sheet.ncols:
    sheet.cell(row, col).value # 获取值
    sheet.cell(row, col).ctype # 获取单元格式

# 处理日期
# 将excel中的日期转化成 datetime对象
xlrd.xldate.xldate_as_datetime(xldate, datemode)
# 将元组转化成excel中的日期
xlrd.xldate.xldate_from_date_tuple(date_tuple, datemode)
# 将excel中的日期转化成元组
xlrd.xldate.xldate_as_tuple(xldate, datemode)

# 其他部分
# 将datetime对象 与 字符串转化
import datetime
# datetime 转 字符串
date = datetime.now()
date_str = date.strftime(&quot;%Y-%m-%d&quot;)
# 字符串 转 datetime
date_str = &quot;2018-08-21&quot;
date = datetime.datetime.strptime(date_str, &apos;%Y-%m-%d&apos;)
</code></pre><ol start="2">
<li><p>写</p>
<pre><code># 新建一个workbook
workbook = xlwt.Workbook.Workbook()
# 新建一个sheet
sheet = workbook.add_sheet(sheetname, cell_overwrite_ok=False)
# 写数据
write(r, c, label=&apos;&apos;, style=&lt;xlwt.Style.XFStyle object&gt;)
# 保存工作簿
workbook.save(&quot;xx.xls&quot;)
</code></pre></li>
<li><p>改</p>
<pre><code># 先读取workbook
import xlrd
from xlutils.copy import copy
workbook = xlrd.open_workbook(&quot;xx.xls&quot;)
wb = copy(workbook)    # 复制一份
wb.get_sheet(0).write(0,0,&apos;changed!&apos;) # 修改
wb.save(&quot;xx.xls&quot;)        
</code></pre></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/07/python发送邮件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/07/python发送邮件/" itemprop="url">python发送邮件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-07T21:28:12+08:00">
                2018-08-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>使用python自动发送邮件</p>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ol>
<li><p>设置配置文件</p>
<pre><code>from_addr = &apos;1090384046@qq.com&apos;
to_addr = &apos;1090384046@qq.com&apos;
smtp_server = &apos;smtp.qq.com&apos;
smtp_port = 465
password = &quot;xxxxxxxxxxxxxxx&quot;
</code></pre></li>
<li><p>规范地址</p>
<pre><code>def addrFormat(s):
  &quot;&quot;&quot;格式化 发送接收的地址&quot;&quot;&quot;
  name, addr = parseaddr(s)
  return formataddr((Header(name, &apos;utf-8&apos;).encode(), addr))
</code></pre></li>
<li><p>构造信息</p>
<pre><code># message 可以是字符串 或者 html字符串
# mode: &apos;plain&apos; 正常文本 &apos;html&apos;网页格式
msg = MIMEMultipart(&apos;alternative&apos;)
msg[&apos;From&apos;] = addrFormat(&apos;ming &lt;%s&gt;&apos; % from_addr)
msg[&apos;To&apos;] = addrFormat(&apos;用户 &lt;%s&gt;&apos; % to_addr)
msg[&apos;Subject&apos;] = Header(&apos;提醒信息&apos;, &apos;utf-8&apos;).encode()
msg.attach(MIMEText(message, mode, &apos;utf-8&apos;))
</code></pre></li>
<li><p>发送</p>
<pre><code>server = smtplib.SMTP_SSL(smtp_server, smtp_port)
# server = smtplib.SMTP(smtp_server, smtp_port)    #如果不是使用QQ服务器发送的话取消注解
# server.starttls()                                #如果不是使用QQ服务器发送的话取消注解
server.login(from_addr, password)
server.sendmail(from_addr, [to_addr], msg.as_string())
server.quit()
</code></pre></li>
<li><p>导入的数据包</p>
<pre><code>from email import encoders
from email.header import Header
from email.mime.text import MIMEText
from email.utils import parseaddr, formataddr
from email.mime.multipart import MIMEMultipart
import smtplib
</code></pre></li>
<li><p>完整代码(需修改配置文件，发送内容) Ctrl F “配置文件”</p>
<pre><code>from email import encoders
from email.header import Header
from email.mime.text import MIMEText
from email.utils import parseaddr, formataddr
from email.mime.multipart import MIMEMultipart
import smtplib

# 配置文件
from_addr = &quot;1090384046@qq.com&quot;
password = &quot;xxxxxxxxxxx&quot;
smtp_server = &apos;smtp.qq.com&apos;
smtp_port = 465

def addrFormat(s):
    &quot;&quot;&quot;格式化 发送接收的地址&quot;&quot;&quot;
    name, addr = parseaddr(s)
    return formataddr((Header(name, &apos;utf-8&apos;).encode(), addr))

def send_mail(to_addr, message, mode):

    msg = MIMEMultipart(&apos;alternative&apos;)
    # msg = MIMEText(message, mode, &apos;utf-8&apos;)
    msg[&apos;From&apos;] = addrFormat(&apos;ming &lt;%s&gt;&apos; % from_addr)
    msg[&apos;To&apos;] = addrFormat(&apos;用户 &lt;%s&gt;&apos; % to_addr)
    msg[&apos;Subject&apos;] = Header(&apos;提醒信息&apos;, &apos;utf-8&apos;).encode()
    msg.attach(MIMEText(message, mode, &apos;utf-8&apos;))

    server = smtplib.SMTP_SSL(smtp_server, smtp_port)
    # server.starttls()
    server.login(from_addr, password)
    server.sendmail(from_addr, [to_addr], msg.as_string())
    server.quit()

# 发送内容
mode = &quot;html&quot;
message = &apos;&apos;&lt;a href=&quot;www.baidu.com&quot;&gt;百度&lt;/a&gt;&apos;
to_addr = &apos;1090384046@qq.com&apos;
send_mail(to_addr, message, mode)
</code></pre></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/07/crontab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/07/crontab/" itemprop="url">crontab</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-07T16:54:12+08:00">
                2018-08-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>学会使用Linux的定时运行脚本</p>
<h1 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h1><ol>
<li><a href="https://www.shiyanlou.com/courses/1/labs/1918/document" target="_blank" rel="noopener">实验楼linux</a></li>
<li><a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001432005226355aadb8d4b2f3f42f6b1d6f2c5bd8d5263000#0" target="_blank" rel="noopener">廖雪峰</a></li>
</ol>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ol>
<li><p>安装crontab  #一般默认已经安装了</p>
<pre><code>yum install crontabs
</code></pre></li>
<li><p>编写或修改 crontab</p>
<pre><code>crontab -e
</code></pre></li>
<li><p>查看crontab</p>
<pre><code>crontab -l
</code></pre></li>
<li><p>删除crontab</p>
<pre><code>crontab -r
</code></pre></li>
<li><p>编写crontab 的 语法</p>
<pre><code>1. * * * * * * test.sh   // 分，时，天，月，星期 执行语句
2. `*/num  设置频率`
3. num1-num2  或者  num1,num2,num3 表示范围
</code></pre></li>
<li><p>查看日志  可以看得出该语句有没有被执行</p>
<pre><code>cat /var/log/cron
# 可以看出有一个错误 mail的错误 原因是IPV6
# 可以通过vim /ets/hosts 注解 #::1
</code></pre></li>
<li><p>查看出错反馈</p>
<pre><code>cat /var/spool/mail/root
</code></pre></li>
<li><p>运行python脚本 需要执行python路径 比如</p>
<pre><code>/root/anaconda3/bin/python /root/ming/findPractice/getMysql.py
</code></pre></li>
<li><p>错误检测</p>
<ol>
<li>服务是否启动</li>
<li>脚本的路径和运行环境 是否写明</li>
<li>脚本 有没有 chmod u+x file</li>
</ol>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/20/scrapy的选择器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/scrapy的选择器/" itemprop="url">scrapy的选择器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-20T12:25:00+08:00">
                2018-07-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>了解scrapy的选择器  xpath css  正则表达式</p>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><h2 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h2><ol>
<li><p>进入Scrapy shell</p>
<pre><code>scrapy shell http://doc.scrapy.org/en/latest/_static/selectos-sample1.html
# 返回的变量是 response
</code></pre></li>
<li><p>查找节点</p>
<pre><code>result = response.selector.xpath(&apos;//a&apos;)
# 返回的是一个SelectorList类

# 查找当前节点下的其他节点

result.xpath(&apos;./img&apos;)

# 根据属性值查找
result.xpath(&apos;//a[@href=&quot;image1.html&quot;]/text()&apos;)
</code></pre></li>
<li><p>提取节点</p>
<pre><code># 因为result.xpath()方法返回的是一个selectorList类
result.extract()
result.extract()[0]
# 有时候extrac方法返回的是一个空值为了防止有数组越界的情况
result.extract_first()
</code></pre></li>
<li><p>根据属性获取信息</p>
<pre><code>#  获取文本
result.xpath(&apos;//a/text()&apos;)
# 获取属性
result.xpath(&apos;//a/@href&apos;)
</code></pre></li>
</ol>
<h2 id="css"><a href="#css" class="headerlink" title="css"></a>css</h2><ol>
<li><p>获取节点</p>
<pre><code>response.css(&apos;a&apos;)  # 直接查找
response.css(&apos;a[href=&quot;image1.html&quot;]&apos;) # 根据属性值查找
response.css(&apos;a[href=&quot;image1.html&quot;] img&apos;)  # 嵌套查找
</code></pre></li>
<li><p>获取属性值</p>
<pre><code>response.css(&apos;a[href=&quot;image1.html&quot;]::text&apos;)
response.css(&apos;a[href=&quot;image1.html img&quot;]::attr(src)&apos;)
</code></pre></li>
<li><p>正则表达式</p>
<pre><code># response对象不能直接调用re()和re_first()方法  如果要进行全文匹配的话 reponse.xpath(&apos;.&apos;).re(&apos;xxx&apos;)
response.xpath(&apos;//a/text()&apos;).re(&apos;Name:\s(.*)&apos;)
</code></pre></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/16/scrapy入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/16/scrapy入门/" itemprop="url">scrapy入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-16T23:41:12+08:00">
                2018-07-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>了解scrapy</p>
<h1 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h1><ol>
<li>scrapy <code>pip install scrapyd</code></li>
<li>如果在window 下安装 scrapy 提示需要安装 Microsoft Visual C++ 14.0,解决办法如下</li>
<li>在<a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/" target="_blank" rel="noopener">国外python库</a>搜索Twisted</li>
<li>cp36代表python36版本，amd64代表64位  选择对应的Teisted.whl包 下载</li>
<li>pip install 选择对应的Teisted.whl包</li>
<li><code>pip install scrapyd</code></li>
</ol>
<h1 id="实践步骤"><a href="#实践步骤" class="headerlink" title="实践步骤"></a>实践步骤</h1><ol>
<li>创建工程</li>
<li>创建爬虫</li>
<li>修改爬虫文件  添加 parse方法</li>
<li>vim items.py 设置 item</li>
<li>vim Pipeline 设置保存  保存到数据库的代码都是一样的</li>
<li>vim settings.py  设置添加插件 并设置优先值 设置数据库的信息</li>
<li>运行</li>
</ol>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ol>
<li><p>创建工程</p>
<pre><code>scrapy startproject tutorial
</code></pre></li>
<li><p>创建Spider</p>
<pre><code>cd tutorial
scrapy genspider quotes quotes.toscrape.com
</code></pre></li>
<li><p>创建Item</p>
<pre><code>#vim items.py
import scrapy
class QuoteItem(scrapy.Item):
    text = scrapy.Field()
    author = scrapy.Field()
    tags = scrapy.Field()
</code></pre></li>
<li><p>解析Response</p>
<pre><code># vim quotes.py
from quotes.items import QuoteItem          # 注意还需要导入这个类
def parse(self, response):
        quotes = response.css(&apos;.quote&apos;)
        for quote in quotes:
            item = QuoteItem()
            item[&apos;text&apos;] = quote.css(&apos;.text::text&apos;).extract_first()
            item[&apos;author&apos;] = quote.css(&apos;.author::text&apos;).extract_first()
            item[&apos;tags&apos;] = quote.css(&apos;.tags .tag::text&apos;).extract()
            yield item     #返回的是scrapy.item子类

        # scrapy.Request 是一个构造请求函数 下面的代码专用于有下一页的链接
        next = response.css(&apos;.pager .next a::attr(&quot;href&quot;)&apos;).extract_first()
        url = response.urljoin(next)
        yield scrapy.Request(url=url, callback=self.parse)
</code></pre></li>
<li><p>使用Item Pipeline</p>
<pre><code># vim spiders/pipelines.py
class TextPipeline(object):

    def __init__(self):
        self.limit = 50

    def process_item(self, item, spider):
        if item[&apos;text&apos;]:
            if len(item[&apos;text&apos;]) &gt; self.limit:
                item[&apos;text&apos;] = item[&apos;text&apos;][0:self.limit].rstrip() + &apos;...&apos;
                return item
        else:
            return DropItem(&apos;Missing Text&apos;)

# 一下这段是一个通用代码  可以自己写在通用爬虫里面
import pymongo

class MongoPipeline(object):
    def __init__(self, mongo_uri, mongo_db):
        self.mongo_uri = mongo_uri
        self.mongo_db = mongo_db

    @classmethod
    def from_crawler(cls, crawler):
        return cls(
            mongo_uri = crawler.settings.get(&apos;MONGO_URI&apos;),
            mongo_db = crawler.settings.get(&apos;MONGO_DB&apos;)
        )

    def open_spider(self, spider):
        self.client = pymongo.MongoClient(self.mongo_uri)
        self.db = self.client[self.mongo_db]

    def process_item(self, item, spider):
        name = item.__class__.__name__
        self.db[name].insert(dict(item))
        return item

    def close_spider(self, spider):
        self.client.close()
</code></pre></li>
<li><p>设置settings.py文件</p>
<pre><code>ITEM_PIPELINES = {
&apos;tutorial.pipelines.TextPipeline&apos;: 300,
&apos;tutorial.pipelines.MongoPipeline&apos;: 400,
}

MONGO_URL = &apos;localhost&apos;
MONGO_DB = &apos;tutorial&apos;
</code></pre></li>
<li><p>启动服务</p>
<pre><code>scrapy crawl quotes
</code></pre></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/15/使用js文件进行加密/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/15/使用js文件进行加密/" itemprop="url">使用js文件进行加密</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-15T11:52:00+08:00">
                2018-07-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>优化 锐捷自动登陆程序</p>
<p>因为 我们的password 是 经过javascript 程序加密过的 那怎么获取加密过的密码呢？</p>
<p>第一种办法</p>
<p>通过浏览器 先登陆一次 按F12 获取 参数(上次的实验就是这样获取)</p>
<p>第二种办法</p>
<p>获取js程序的代码 运行js代码 获取 加密后的密码</p>
<p>这次实验就是 用第二种办法</p>
<h1 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h1><ol>
<li><a href="https://pypi.org/project/PyExecJS/" target="_blank" rel="noopener">PyExecJS</a> <code>pip install PyExecJS</code></li>
</ol>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ol>
<li><p>获取加密js文件</p>
<ol>
<li>打开 <a href="http://enet.10000.gd.cn:10001/zq/zq251/index.jsp?wlanacip=xxxxx&amp;wlanuserip=xxxxxx" target="_blank" rel="noopener">http://enet.10000.gd.cn:10001/zq/zq251/index.jsp?wlanacip=xxxxx&amp;wlanuserip=xxxxxx</a></li>
<li>F12 网络 所有 查看 文件 搜索 password</li>
<li>在一个index.js文件里面发现 <code>password.value = BASE64.encoder(password.value);</code></li>
<li>在base64.js 文件发现encoder函数</li>
</ol>
</li>
<li><p>分析 js文件</p>
<ol>
<li><code>(function(){主要代码 window.BASE64 = __BASE64; })()</code></li>
<li>加密程序 在匿名函数的主要代码里面,那么怎么去引用里面的代码呢？</li>
<li>查找资料发现 window.BASE64 是声明全局变量的， 通过 BASE64就能引用里面的内容了</li>
<li>但是 python执行的js文件程序 识别不了 window, 那么我就把主要代码给提出来保存到base64.txt文件</li>
</ol>
</li>
<li><p>python执行js文件里面的函数</p>
<pre><code>import execjs
password = &apos;12345678&apos;
password1 = execjs.compile(open(&apos;base64.txt&apos;, encoding=&apos;UTF-8&apos;).read()).call(&apos;BASE64.encoder&apos;, password)
print(password1)      #返回的结果和在浏览器提取的password1参数一样
</code></pre></li>
<li><p>熟悉一下加密和解密</p>
<pre><code>encoder函数 输入 字符串 返回 字符串
decoder函数 输入 字符串 返回 ascii码 的 列表

a = 48      #ascii码
a = chr(a)  #ascii码转字符
</code></pre></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/15/JavaScript基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/15/JavaScript基础/" itemprop="url">JavaScript基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-15T08:06:00+08:00">
                2018-07-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>了解js</p>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ol>
<li><script> 标签

     <script>
     alert("Hello World");
     </script>

<pre><code>&lt;script&gt;
document.write(&quot;&lt;h1&gt;这是一个标题&lt;/h1&gt;&quot;)
document.write(&quot;&lt;p&gt;这是一个段落&lt;/p&gt;&quot;)
&lt;/script&gt;
</code></pre></li>
<li><p>script代码一般放在页面底部</p>
<pre><code>#监测触发时间并调用函数
&lt;script&gt;
function myFunction()
{
  alert(&apos;Hello World&apos;);
}
&lt;/script&gt;

&lt;button type=&quot;button&quot;, onclick=&quot;myFunction()&quot;&gt;hello&lt;/button&gt;
</code></pre></li>
<li><p>引用外部js</p>
<pre><code>&lt;script src=&quot;myScript.js&quot;&gt;&lt;/script&gt;
</code></pre></li>
<li><p>操作HTML元素</p>
<pre><code>document.write(Data())
document.getElementById(&quot;demo&quot;).innerHTML=&quot;Hello World&quot;;
document.getElementById(id).attribute=new value   
document.getElementById(&quot;p2&quot;).style.color= &quot;blue&quot;;
</code></pre></li>
<li><p>写到文档输出</p>
<pre><code>#会覆盖已经显示的html语言
document.write(&quot;&lt;p&gt;Hello World&lt;/p&gt;&quot;);
</code></pre></li>
<li><p>注释</p>
<pre><code>单行注释 `/  /`
多行注释 `/* */`
</code></pre></li>
<li><p>变量</p>
<pre><code>var x = 5;  //声明
x           //使用
</code></pre></li>
<li><p>类型</p>
<pre><code>var cars = new Array(); //声明数组
cars[0] = &quot;Saab&quot;; //使用
</code></pre></li>
<li><p>对象</p>
<pre><code>var person = {firstname:&quot;John&quot;, lastname:&quot;Doe&quot;} //对象是一个字典 key不用双引号标注
person.lastname      //使用
person[&quot;lastname&quot;]   //使用

person = null;       //清空对象
</code></pre></li>
<li><p>js的变量支持动态类型，也可以声明类型,下面例子是变量声明类型</p>
<pre><code>var carname = new String;
var x = new Number;
var y = new Boolean;
var person = new Object;
</code></pre></li>
<li><p>对象的操作</p>
<pre><code># string对象的内置属性和方法
var txt = &quot;Hello World&quot;
txt.length
txt.indexOf()
txt.replace()
txt.search()
</code></pre></li>
<li><p>函数</p>
<pre><code># 函数声明
function functionname()
{

}

# 调用
functionname()
</code></pre></li>
</ol>
<ol start="13">
<li><p>声明 全局变量</p>
<pre><code>carname = &quot;Volvo&quot;
</code></pre></li>
<li><p>if for 语句与c语言一样  </p>
<pre><code>#支持这种写法
for(x in person)
{

}
</code></pre></li>
<li><p>try catch 检测异常</p>
<pre><code>try{

}catch(err){

}

# 自定义抛出异常
throw &quot;message&quot;
</code></pre></li>
<li><p>检测表单</p>
<pre><code>function validateForm()
{
var x=document.forms[&quot;myForm&quot;][&quot;fname&quot;].value;
if (x==null || x==&quot;&quot;)
{
alert(&quot;First name must be filled out&quot;);
return false;
}
}

#使用
&lt;form name=&quot;myForm&quot; action=&quot;demo_form.asp&quot; onsubmit=&quot;return validateForm()&quot; method=&quot;post&quot;&gt;
First name: &lt;input type=&quot;text&quot; name=&quot;fname&quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
&lt;/form&gt;
</code></pre></li>
<li><p>事件</p>
<pre><code>onclick
onload      #加载
onunload    #离开
onchange    #完成输入（离开输入框并外面点击）
onmouseover
onmouseout
onmousedown
onmouseup
</code></pre></li>
<li><p>创建，删除 元素</p>
<pre><code>var element=document.getElementById(&quot;div1&quot;);
var para=document.createElement(&quot;p&quot;);
var node=document.createTextNode(&quot;This is new.&quot;);
element.appendChild(node);

var parent=document.getElementById(&quot;div1&quot;);
var child=document.getElementById(&quot;p1&quot;);
parent.removeChild(child);
</code></pre></li>
<li><p>对象的构造器</p>
<pre><code>function person(firstname,lastname)
{
this.firstname=firstname;
this.lastname=lastname;
}
#使用构造器创建对象
var person1=new person(&quot;John&quot;,&quot;Doe&quot;);

#如果不使用构造器创建对象可以直接这样
var person1 = {firstname:&quot;John&quot;, lastname:&quot;Doe&quot;}

#把方法添加到对象
function person(firstname,lastname)
{
this.firstname=firstname;
this.lastname=lastname;
this.changeName=changeName;   #声明是该类的方法  下面是方法的声明
function changeName(name)
{
this.lastname=name;
}
}
</code></pre></li>
<li><p>Number对象</p>
<pre><code>isNaN(x)  # 判断 x是否是数字
</code></pre></li>
<li><p>window对象</p>
<pre><code>#所有 JavaScript 全局对象、函数以及变量均自动成为 window 对象的成员
windwo.document.getElementById(&apos;header&apos;)
</code></pre></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/14/模拟登陆教务管理系统/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/14/模拟登陆教务管理系统/" itemprop="url">模拟登陆教务管理系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-14T20:42:00+08:00">
                2018-07-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>巩固一下模拟登陆(教务管理系统不用验证码)</p>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ol>
<li><p>获取登陆链接 与 数据 1</p>
<ol>
<li><a href="http://jwgl.zqu.edu.cn/" target="_blank" rel="noopener">http://jwgl.zqu.edu.cn/</a></li>
<li>按下F12键 选择网络</li>
<li>输入账号和密码和验证码 登陆</li>
<li>获得post文件 参看参数  和 消息头(本以为快弄好了)</li>
<li>但是没有查看到参数 那么肯定就不是这个url了</li>
<li>下一步分析一下html文件</li>
</ol>
</li>
</ol>
<ol start="2">
<li><p>获取登陆链接 与 数据 2</p>
<ol>
<li><a href="http://jwgl.zqu.edu.cn/" target="_blank" rel="noopener">http://jwgl.zqu.edu.cn/</a></li>
<li>按下F12键 选择网络 选择查看器左边的鼠标定位 定位到表单</li>
<li>发现 账号的id是account,密码的id是 password,url=””</li>
<li>我尝试着提交上去  登陆不了</li>
<li>那么我猜测是用到js的原因，接下来我获取 <a href="http://jwgl.zqu.edu.cn/" target="_blank" rel="noopener">http://jwgl.zqu.edu.cn/</a> 的response.text保存到文本里准备分析</li>
<li><p>搜索”POST” 获取一下代码</p>
<pre><code> $.ajax({
url:&quot;/login!fetchMm.action&quot;,
type:&quot;POST&quot;,
data:{
  account:account,
  mmtip:mmtip,
  verifycode:verifycode
},
dataType:&quot;json&quot;,
complete:function(){
  layer.close(l_index);
},
success:function(result){
  if(result.status == &apos;y&apos;){//成功
    layer.alert(&quot;密码重置成功：&quot;+result.msg+&quot;，&lt;br&gt;登陆后请尽快修改&quot;,7,function(){layer.closeAll();});
  }else{//失败
    changeVerifyCode();
    layer.alert(result.msg);
  }
 },
 error:function(){
  layer.alert(&quot;登录超时，请稍后重试！&quot;);
  }
 });
  }
</code></pre></li>
<li><p>通过上面代码可以看出<br> url:<a href="http://jwgl.zqu.edu.cn/login!fetchMm.action" target="_blank" rel="noopener">http://jwgl.zqu.edu.cn/login!fetchMm.action</a><br> data:account， mmtip, verifycode</p>
</li>
<li><p>分别找account,mmtip,verifycode的赋值情况<br> 发现account就是账号，mmtip就是密码 verifycode是空值</p>
</li>
</ol>
</li>
<li><p>获取了url,data 就可以登陆了，下面是代码</p>
<pre><code>import requests

headers = {
    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0&apos;,
    &apos;Connection&apos;: &apos;keep-alive&apos;,
    &apos;ConTent-Type&apos;: &apos;application/x-www-form-urlencoded; charset=UTF-8&apos;,
    &apos;Host&apos;: &apos;jwgl.zqu.edu.cn&apos;,
}

data = {
    &apos;account&apos;: &apos;xxxxx&apos;,  #账号
    &apos;pwd&apos;: &apos;xxxxx&apos;,      #密码
    &apos;verifycode&apos;: &apos;&apos;,
}

s = requests.Session()
def login(account, pwd):
    data = {
        &apos;account&apos;: account,
        &apos;pwd&apos;: pwd,
        &apos;verifycode&apos;: &apos;&apos;,
    }
    url = &apos;http://jwgl.zqu.edu.cn/login!doLogin.action&apos;
    response = s.post(url, headers=headers, data=data)
</code></pre></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/14/锐捷自动登陆/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="speakfly">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/14/锐捷自动登陆/" itemprop="url">锐捷自动登陆</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-14T19:53:00+08:00">
                2018-07-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>因为学校网络原因，每次开机都需要登陆才能联网</p>
<p>学习了爬虫，想要实现自动登陆</p>
<h1 id="实践操作"><a href="#实践操作" class="headerlink" title="实践操作"></a>实践操作</h1><ol>
<li><p>获取登陆链接</p>
<ol>
<li><a href="http://enet.10000.gd.cn:10001/zq/zq251/index.jsp?wlanacip=xxxxx&amp;wlanuserip=xxxxxx" target="_blank" rel="noopener">http://enet.10000.gd.cn:10001/zq/zq251/index.jsp?wlanacip=xxxxx&amp;wlanuserip=xxxxxx</a></li>
<li>按下F12 选择网络  </li>
<li>输入账号和密码和验证码 登陆</li>
<li><p>获得post文件 参看参数  和 消息头</p>
<p> url: <a href="http://enet.10000.gd.cn:10001/login.do" target="_blank" rel="noopener">http://enet.10000.gd.cn:10001/login.do</a></p>
<p> data: edubas, eduuser, password1 patch, rand, userName1  (其中rand是验证码是随机的，其他都是固定值)</p>
</li>
<li>也就是说我们只需要 requests.post(url,data=data,headers=headers) 就能模拟登陆了</li>
</ol>
</li>
<li><p>获取图片验证码</p>
<ol>
<li><p>点击 网络 图片 查找验证码图片 获得url</p>
<blockquote>
<p>url:<a href="http://enet.10000.gd.cn:10001/common/image.jsp?time=1531570000864" target="_blank" rel="noopener">http://enet.10000.gd.cn:10001/common/image.jsp?time=1531570000864</a></p>
</blockquote>
<blockquote>
<p>发现获取图片的链接有一个参数 time</p>
</blockquote>
<blockquote>
<p>先不管time 看一下 <a href="http://enet.10000.gd.cn:10001/common/image.jsp" target="_blank" rel="noopener">http://enet.10000.gd.cn:10001/common/image.jsp</a> 能不能获取图片</p>
</blockquote>
<blockquote>
<p>发现果真能获取的了(如果获取不了的话还要分析time的值是如何获取的)</p>
</blockquote>
</li>
<li><p>处理验证码图片获取验证码</p>
<blockquote>
<p>正常来说 tesserocr <code>pip install tesserocr pillow</code>就可以安装了<br>但是在win10环境下 需要安装 Microsoft Visual C++ 14.0 所以我换另一种方法<br>用 python 去调用 <a href="http://digi.bib.uni-mannheim.de/tesseract" target="_blank" rel="noopener">tesserorcr.exe</a>程序<br>需要设置tesserocr的环境变量<br>cmd上的tesserocr的命令是<code>tesserocr xx.jpg xx</code>  会生成xx.txt文件</p>
</blockquote>
<pre><code>cmd = &quot;tesseract &quot; + IMAGE_URL + &quot; &quot; + TXT_URL[:-4]         #因为会补全.txt 所以去掉TXT_URL最后4个字符
os.environ.setdefault(&quot;TESSDATA_PREFIX&quot;, &quot;C:\Program Files (x86)\Tesseract-OCR&quot;) # 设置环境变量
os.system(cmd)                                                                   # 调用命名
</code></pre><blockquote>
<p>打开xx.txt发现果真就是4位验证码<br>但是需要注意如果使用<code>with open(&#39;xx.txt&#39;) as f:</code>获取验证码的时候，f.read()返回的是6位字符 需要进行截取f.read()[:4]</p>
</blockquote>
</li>
</ol>
</li>
<li><p>代码</p>
<pre><code>import os
import requests
from PIL import Image
import sys

headers = {
    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.162 Safari/537.36&apos;,
    &apos;Accept&apos;: &apos;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&apos;,
    &apos;Connection&apos;: &apos;keep-alive&apos;,
    &apos;Host&apos;: &apos;enet.10000.gd.cn:10001&apos;,
}

IP = &quot;xxx.xxx.xxx.xxx&quot;               #需要修改成自己的ip
ID = &quot;xxxxxxxxxx&quot;                    #需要修改成自己的学号
PASSWORD1 = &quot;xxxxxxxx&quot;               #需要修改自己的密码 这个密码是经过加密的，可以在浏览器查看
</code></pre></li>
</ol>
<pre><code>PATH = sys.path[0]                       #获取文件目录路径
IMAGE_URL = sys.path[0] + &quot;\\test.jpg&quot;   #设定图片路径
TXT_URL = sys.path[0] + &quot;\\test.txt&quot;     #设置文本路径
s = requests.Session()                   #保持会话


def get_image():
    &quot;&quot;&quot;获取验证图片&quot;&quot;&quot;
    image = &apos;http://enet.10000.gd.cn:10001/common/image.jsp&apos;
    response = s.get(image, headers=headers)

    &quot;&quot;&quot;保存图片&quot;&quot;&quot;
    if response.status_code == 200:
        with open(IMAGE_URL, &apos;wb&apos;) as f:
            f.write(response.content)
    else:
        print(&apos;获取图片失败&apos;)


def get_random():
    &quot;&quot;&quot;获取验证码&quot;&quot;&quot;
    cmd = &quot;tesseract &quot; + IMAGE_URL + &quot; &quot; + TXT_URL[:-4]       # 设置windwo的tesseract命令 tesseract xx.jpg xx(会自动补全.txt后缀)
    os.environ.setdefault(&quot;TESSDATA_PREFIX&quot;, &quot;C:\Program Files (x86)\Tesseract-OCR&quot;) # 设置环境变量
    os.system(cmd)                                                                   # 调用命名
    time.sleep(1)
    with open(TXT_URL) as f:
        random = f.read()
    return random[:4]

def check():
    &quot;&quot;&quot;验证&quot;&quot;&quot;
    random = get_random()                                #获取验证码
    url = &apos;http://enet.10000.gd.cn:10001/login.do&apos;
    data = {
        &apos;edubas&apos;: &apos;119.146.99.27&apos;,
        &apos;eduuser&apos;: IP,
        &apos;password1&apos;: PASSWORD1,
        &apos;patch&apos;: &apos;wifi&apos;,
        &apos;rand&apos;: random,
        &apos;userName1&apos;: ID,
    }
    response =s.post(url, headers=headers, data=data)
    # print(response.text)
    if response.status_code == 200:
        print(&apos;锐捷登陆成功&apos;)

if __name__ == &quot;__main__&quot;:

    get_image()
    check()
</code></pre><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><pre><code>经过这次实验，我更加熟悉模拟登陆的流程， 使用会话保持 requests.Session()会免去很多麻烦
读取xx.txt 文件需要检查一下字符 特别是换行，空格，tab
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">speakfly</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">speakfly</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
